<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>iohk-monitoring-framework</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Alexander Diemand, Andreas Triantafyllos and Neil Davies"></meta><meta name="description" content="logging, benchmarking, monitoring"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="style.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress" data-transition-duration="1500"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="wip-logging-benchmarking-and-monitoring">WIP logging, benchmarking and monitoring</h1><h2 id="alexander-diemand-andreas-triantafyllos-and-neil-davies">Alexander Diemand, Andreas Triantafyllos, and Neil Davies</h2><h3 id="id1">2018-12-04</h3></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="aim">Aim</h1><ul><li>combine logging and benchmarking</li><li>add monitoring on top</li><li>provide means for micro-benchmarks</li><li>runtime configuration</li><li>adaptable to needs of various stakeholders</li></ul></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="logging">1 logging</h1><p>Purpose: capture and output messages</p><ul><li>static message creation <tt>(Severity, String)</tt><ul><li><tt>logInfo "this is a message"</tt></li></ul></li><li>non-blocking, low overhead - decoupled via message queue</li><li>backend - routed in a statically programmed way</li></ul><p class="substep">What if we want to drop some of the messages?</p><p class="substep">Or, increase the <tt>Severity</tt> of a particular message?</p></div><div class="step step-level-1" step="3" data-scale="3" data-y="1500" data-x="4450" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="trace">1.1 trace</h1><ul><li>implemented as a <a href="https://hackage.haskell.org/package/contravariant-1.5/docs/Data-Functor-Contravariant.html">Contravariant</a> <tt>Trace</tt> (thanks to Alexander Vieth)</li><li>not in monad stack, but passed as an argument<ul><li><tt>logInfo logTrace "this is a message"</tt></li></ul></li><li>New: we can build hierarchies<blockquote><ul><li>captures call graph</li><li>parents can decide how their child traces are processed</li><li>runtime configurable</li></ul></blockquote></li><li>each Trace has its own behaviour: <tt>NoTrace</tt> ..<ul><li>example in: <a href="https://github.com/input-output-hk/iohk-monitoring-framework/blob/40eb8eb172037d85949f533efecfcffab54e136a/src/Cardano/BM/Trace.lhs#L296">Trace.subTrace</a></li></ul></li></ul></div><div class="step step-level-1" step="4" data-scale="1" data-y="0" data-x="9450" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="benchmarking">2 benchmarking</h1><p>Purpose: observe outcomes and events, and prepare them for later analysis</p><ul><li>record events with exact timestamps</li><li>currently: JSON format directly output to a file</li></ul><ul><li>we will integrate this into our logging</li></ul><p class="substep">What if we want to stop recording some of the events? Or, turn on others?</p></div><div class="step step-level-1" step="5" data-scale="3" data-y="1500" data-x="10200" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="observables">2.1 observables</h1><p>Outcomes have a starting and terminating time point.</p><ul><li>bracket <tt>STM</tt> (<a href="https://github.com/input-output-hk/iohk-monitoring-framework/blob/40eb8eb172037d85949f533efecfcffab54e136a/src/Cardano/BM/Observer/STM.lhs#L31">Observer.STM</a>) and <tt>Monad</tt> (<a href="https://github.com/input-output-hk/iohk-monitoring-framework/blob/40eb8eb172037d85949f533efecfcffab54e136a/src/Cardano/BM/Observer/Monadic.lhs#L37">Observer.Monad</a>) actions</li><li>record O/S metrics: <a href="https://github.com/input-output-hk/iohk-monitoring-framework/blob/40eb8eb172037d85949f533efecfcffab54e136a/src/Cardano/BM/Counters/Linux.lhs#L36">Counters.Linux</a><ul><li>calculate rate of change, durations, ..</li></ul></li></ul></div><div class="step step-level-1" step="6" data-scale="1" data-y="0" data-x="15200" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="monitoring">3 monitoring</h1><p>Purpose: analyse messages and once above a threshold (frequency, value)
trigger a cascade of alarms</p><ul><li>built on observables, outcomes, events<ul><li>processing the stream of them</li><li>aggregates statistics</li><li>tracking thresholds</li></ul></li></ul></div><div class="step step-level-1" step="7" data-y="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20200" data-z="0"><h1 id="configuration">4 configuration</h1><p>Purpose: change behaviour of LoBeMo in a named context</p><ul><li>changed at runtime<ul><li>redirects output (output selection)</li><li>overwrites Severity (tbd)</li><li>filters by Severity</li><li>defines SubTrace</li></ul></li></ul><img src="./ConfigurationModel.png"></img></div><div class="step step-level-1" step="8" data-scale="3" data-y="1500" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-x="25200" data-z="0"><h1 id="output-selection">4.1 output selection</h1><p>Redirection of log messages and observables to different outputs:</p><p>aggregation | EKG | Katip</p><img src="./Activity.png"></img></div><div class="step step-level-1" step="9" data-scale="3" data-y="3000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-x="30200" data-z="0"><h1 id="information-reduction">4.1.1 information reduction</h1><ul><li><a href="https://github.com/input-output-hk/iohk-monitoring-framework/blob/40eb8eb172037d85949f533efecfcffab54e136a/src/Cardano/BM/Aggregated.lhs#L13">Aggregation</a></li><li>filtering: <a href="https://github.com/input-output-hk/iohk-monitoring-framework/blob/40eb8eb172037d85949f533efecfcffab54e136a/src/Cardano/BM/Trace.lhs#L154">traceConditionally</a></li></ul></div><div class="step step-level-1" step="10" data-y="3000" data-x="32400" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="3" data-z="0"><h1 id="ekg-metrics-view">4.1.2 EKG metrics view</h1><ul><li>defined standard metrics</li><li>our own metrics: labels and gauges</li></ul></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="3" data-x="34600" data-y="3000" data-z="0"><h1 id="katip-log-files">4.1.3 Katip log files</h1><ul><li><tt>katip</tt> based queue and scribes</li><li>log rotation</li></ul></div><div class="step step-level-1" step="12" data-scale="1" data-y="0" data-x="39600" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="id2">5  ...</h1><ul><li>requirements</li><li>performance &amp; security</li><li>integration, PoC</li></ul></div><div class="step step-level-1" step="13" data-scale="0.75" data-y="500" data-x="40600" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="logging-requirements">5.1 #logging-requirements</h1><ul><li>Support<blockquote><ul><li>reduced size of logs</li><li>automated log analysis</li></ul></blockquote></li><li>Devops<blockquote><ul><li>run <em>core</em> nodes</li><li>monitoring</li></ul></blockquote></li><li>Developers<blockquote><ul><li>run unit/property testing</li><li>micro-benchmarks</li></ul></blockquote></li><li>QA testing &amp; benchmarks<blockquote><ul><li>run integration tests</li><li>run (holistic) benchmarks</li></ul></blockquote></li></ul></div><div class="step step-level-1" step="14" data-scale="0.5" data-y="500" data-x="41600" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="performance-and-security-considerations">5.2 performance and security considerations</h1><ul><li>how much does capturing of metrics cost?</li><li>conditional compilation: can we exclude/disable benchmarking code from end-user products?<ul><li>high-end users (exchanges, enterprises)</li><li>wallet users</li></ul></li></ul></div><div class="step step-level-1" step="15" data-scale="0.2" data-y="500" data-x="42000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="integration">5.3 integration</h1><ul><li>enable micro-benchmarks in <tt>Cardano</tt></li><li>integration into <tt>node-shell</tt></li><li>PoC in <tt>ouroboros-network</tt></li></ul></div><div class="step step-level-1" step="16" data-scale="1" data-y="-1000" data-x="45000" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-z="0"><h1 id="project-overview">8 project overview</h1><blockquote><p>&gt;&gt; <a href="https://github.com/input-output-hk/iohk-monitoring-framework">projectURL</a> &lt;&lt;</p></blockquote><ul><li>literate Haskell (thanks to Andres for lhs2TeX)<blockquote><ul><li>documentation of source code</li><li>documentation of tests</li></ul></blockquote></li><li>this <a href="https://input-output-hk.github.io/iohk-monitoring-framework/">presentation</a></li><li>we still need help for:<blockquote><ul><li><tt>nix</tt> scripts</li><li><tt>buildkite</tt> CI setup</li></ul></blockquote></li></ul></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="48000" data-y="-2500" data-z="0"><h1 id="the-end">the end</h1></div></div><div class="footer"><p>IOHK - logging, benchmarking, monitoring @ <a href="https://github.com/input-output-hk/iohk-monitoring-framework">https://github.com/input-output-hk/iohk-monitoring-framework</a></p></div><div id="slide-number" class="slide-number">
        1
      </div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script><script type="text/javascript">
        document.getElementById("impress").addEventListener("impress:stepenter", update_slide_number, false);
      </script></body></html>